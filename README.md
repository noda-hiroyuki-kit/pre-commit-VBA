# Pre-commit VBA

[**日本語はこちら**](README_JA.md)

[![pre-commit](https://img.shields.io/badge/pre--commit-enabled-brightgreen?logo=pre-commit)](https://github.com/pre-commit/pre-commit)
[![MIT License](https://img.shields.io/badge/license-MIT-blue.svg?style=flat)](LICENCE)

## Overview

This is a pre-commit hook that extracts VBA code from Excel files to manage Excel VBA code with git.  
It can also be used as a Python script.

### Usage as a pre-commit hook

Add the following to your `.pre-commit-config.yaml`:

```
  - repo: https://github.com/noda-hiroyuki-kit/pre-commit-vba
    rev: v0.1.1
    hooks:
      - id: extract-vba-code
      - id: check-excel-book-version
```

### Usage by running `pre_commit_vba.py` as a command

After installing uv,
```console
uv run pre_commit_vba.py extract
```
will output the code from Excel files in UTF-8 format.

Also, when working on a Git release branch,
```console
uv run pre_commit_vba.py check
```
will compare the document version of the Excel file and the branch name. If they match, it will output:
```console
Version check passed.
```

## Installation

The following instructions use `mise`.  
Please refer to `mise` for installation.
If you can use `uv`, `mise` is not required.

### Usage as a pre-commit hook

1. Move to the folder containing the macro-enabled workbook you want to manage with `git` (hereafter referred to as vba_root_folder).
2. Install `.pre-commit`.
    1. Install `uv` using `mise`.
        ```
        mise use uv@latest
        ```
    2. Initialize `uv`.
        ```
        uv init
        ```
    3. Install `pre-commit`.
        ```
        uv add pre-commit
        uv run pre-commit install
        ```
    4. Create `.pre-commit-config.yaml` and add the following:
        ```
        ---
        repos:
        - repo: https://github.com/noda-hiroyuki-kit/pre-commit-vba
            rev: v0.1.1
            hooks:
            - id: extract-vba-code
            - id: check-excel-book-version

        ```
### Usage by running `pre_commit_vba.py` as a command

1. Move to the folder containing the macro-enabled workbook you want to manage with `git` (hereafter referred to as vba_root_folder).
2. Install `uv` with `mise`.
    ```console
    mise use uv@latest
    ```
3. Initialize `uv`.
    ```
    uv init
    ```
3. Copy `pre_commit_vba.py` from `src/pre_commit_vba` to vba_root_folder.


## Usage

### Usage as a pre-commit hook

1. Stage the target macro workbook with `git`.
    ```
    git add .
    ```
2. Run `pre-commit` with uv.
    ```
    uv run pre-commit
    ```
3. The code will be extracted, so stage the code and manage it with `git`.
    ```
    git add .
    ```

### Usage by running `pre_commit_vba.py` as a command

#### To extract code from a workbook

In vba_root_folder, run:
```console
uv run pre_commit_vba.py extract
```

#### To compare the release branch name and workbook version information

In vba_root_folder, run:
```PowerShell
uv run pre_commit_vba.py check
```

#### About the command line

The following is the documentation generated by the command (`uv run typer pre_commit_vba.py utils docs`).

---
**Usage**:

```console
$ [OPTIONS] COMMAND [ARGS]...
```

**Options**:

* `--install-completion`: Install completion for the current shell.
* `--show-completion`: Show completion for the current shell, to copy it or customize the installation.
* `--help`: Show this message and exit.

**Commands**:

* `extract`: Extract VBA code from Excel workbooks.
* `check`: Check between workbook version and...

## `extract`

Extract VBA code from Excel workbooks.

**Usage**:

```console
$ extract [OPTIONS]
```

**Options**:

* `--target-path TEXT`: [default: .]
* `--folder-suffix TEXT`: [default: .VBA]
* `--export-folder TEXT`: [default: export]
* `--custom-ui-folder TEXT`: [default: customUI]
* `--code-folder TEXT`: [default: code]
* `--version`
* `--enable-folder-annotation / --disable-folder-annotation`: [default: enable-folder-annotation]
* `--create-gitignore / --not-create-gitignore`: [default: create-gitignore]
* `--help`: Show this message and exit.

## `check`

Check between workbook version and repository name.

**Usage**:

```console
$ check [OPTIONS]
```

**Options**:

* `--target-path TEXT`: [default: .]
* `--version`
* `--help`: Show this message and exit.

## References

### pre_commit_vba.py

[Agent6-6-6/Excel-VBA-XML-Export-Pre-Commit-Hook](https://github.com/Agent6-6-6/Excel-VBA-XML-Export-Pre-Commit-Hook)

[Get git branch name and tag name in python](https://qiita.com/mynkit/items/73b20fb0ad124c0ea8e9)

### test.xlsm

[git repository office custom ui editor](https://github.com/OfficeDev/office-custom-ui-editor)

[Using Excel Ribbon UI as a business application](https://qiita.com/tomochan154/items/3614b6f3ebc9ef947719)

[Switching compiler operation easily when distributing XLSM developed with TDD using RubberDuck by @ShortArrow(Sabotaro)](https://qiita.com/ShortArrow/items/a16477a0926a68a88ead)
